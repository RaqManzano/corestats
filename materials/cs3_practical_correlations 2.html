<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.2.134" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />


<title>Correlations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<!-- htmldependencies:E3FAD763 -->
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="/index.html" class="navbar-brand navbar-brand-logo">
    <img src="/_extensions/cambiotraining/courseformat/img/university_crest_reversed.png" alt="" class="navbar-logo" />
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
  aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"
  onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="/index.html">
 Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="/setup.html">
 Setup</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="/materials.html">
 Materials</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/cambiotraining/corestats/"><i 
  class="bi bi-github" 
  role="img" 
  aria-label="Bioinformatics Training Facility GitHub" 
>
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/bioinfocambs"><i 
  class="bi bi-twitter" 
  role="img" 
  aria-label="Bioinformatics Training Facility Twitter" 
>
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <div id="quarto-toc-target"></div>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Correlations</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>
<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#libraries-and-functions" id="toc-libraries-and-functions">Libraries and functions</a></li>
  <li><a href="#purpose-and-aim" id="toc-purpose-and-aim">Purpose and aim</a></li>
  <li><a href="#data-and-hypotheses" id="toc-data-and-hypotheses">Data and hypotheses</a></li>
  <li><a href="#summarise-and-visualise" id="toc-summarise-and-visualise">Summarise and visualise</a></li>
  <li><a href="#implement-and-interpret-test" id="toc-implement-and-interpret-test">Implement and interpret test</a></li>
  <li><a href="#exercise-pearsons-r-for-usa-state-data" id="toc-exercise-pearsons-r-for-usa-state-data">Exercise: Pearson’s r for USA state data</a></li>
  <li><a href="#spearmans-rank-correlation-coefficient" id="toc-spearmans-rank-correlation-coefficient">Spearman’s rank correlation coefficient</a></li>
  <li><a href="#exercise-state-data-spearman" id="toc-exercise-state-data-spearman">Exercise: State data (Spearman)</a></li>
  <li><a href="#key-points" id="toc-key-points">Key points</a></li>
  </ul>
</nav>
<div class="cell">

</div>
<div class="cell">

</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-caption-container flex-fill">
Learning outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Questions</strong></p>
<ul>
<li>What are correlation coefficients?</li>
<li>What kind of correlation coefficients are there and when do I use them?</li>
</ul>
<p><strong>Objectives</strong></p>
<ul>
<li>Be able to calculate correlation coefficients in R or Python</li>
<li>Use visual tools to explore correlations between variables</li>
<li>Know the limitations of correlation coefficients</li>
</ul>
</div>
</div>
<section id="libraries-and-functions" class="level2">
<h2>Libraries and functions</h2>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-caption-container flex-fill">
Click to expand
</div>
<div class='callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end'><i class='callout-toggle'></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">tidyverse</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<section id="libraries" class="level3">
<h3>Libraries</h3>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A collection of R packages designed for data science</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Converts stats functions to a tidyverse-friendly format</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstatix)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Creates diagnostic plots using ggplot2</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggResidpanel)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># A package for exploring correlations in R</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrr)</span></code></pre></div>
</div>
</section>
<section id="functions" class="level3">
<h3>Functions</h3>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creates diagnostic plots</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>ggResidpanel<span class="sc">::</span><span class="fu">resid_panel</span>()</span></code></pre></div>
</div>
</section>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">

</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">

</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="purpose-and-aim" class="level2">
<h2>Purpose and aim</h2>
<p>Correlation refers to the relationship of two variables (or data sets) to one another. Two data sets are said to be correlated if they are not independent from one another. Correlations can be useful because they can indicate if a predictive relationship may exist. However just because two data sets are correlated does not mean that they are causally related.</p>
</section>
<section id="data-and-hypotheses" class="level2">
<h2>Data and hypotheses</h2>
<p>We will use the <code>USArrests</code> data set for this example. This rather bleak data set contains statistics in arrests per 100,000 residents for assault, murder and robbery in each of the 50 US states in 1973, alongside the proportion of the population who lived in urban areas at that time. <code>USArrests</code> is a data frame with 50 observations of five variables: <code>state</code>, <code>murder</code>, <code>assault</code>, <code>urban_pop</code> and <code>robbery</code>.</p>
<p>We will be using these data to explore if there are correlations between these variables.</p>
<p>The data are stored in the file <code>data/CS3-usarrests.csv</code>.</p>
</section>
<section id="summarise-and-visualise" class="level2">
<h2>Summarise and visualise</h2>
<p>First, we load the data:</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">tidyverse</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>USArrests <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/CS3-usarrests.csv&quot;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># have a look at the data</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>USArrests</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 5
   state       murder assault urban_pop robbery
   &lt;chr&gt;        &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 Alabama       13.2     236        58    21.2
 2 Alaska        10       263        48    44.5
 3 Arizona        8.1     294        80    31  
 4 Arkansas       8.8     190        50    19.5
 5 California     9       276        91    40.6
 6 Colorado       7.9     204        78    38.7
 7 Connecticut    3.3     110        77    11.1
 8 Delaware       5.9     238        72    15.8
 9 Florida       15.4     335        80    31.9
10 Georgia       17.4     211        60    25.8
# … with 40 more rows</code></pre>
</div>
</div>
<p>We can create a visual overview of the potential correlations that might exist between the variables. For this, we use the <code>corrr</code> package.</p>
<p>Make sure to install the package, if you haven’t done so already:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;corrr&quot;</span>)</span></code></pre></div>
</div>
<p>and then load it:</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrr)</span></code></pre></div>
</div>
<p>We can only calculate correlations between numerical variables, so we have to deselect the <code>state</code> variable. Next, we calculate the correlations with <code>correlate()</code>. We <code>shave()</code> off the redundant top results (<code>murder</code> vs <code>assault</code> is the same as <code>assault</code> vs <code>murder</code>) and plot the result using <code>rplot()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create correlation graph</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>USArrests <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>state) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">correlate</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">shave</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rplot</span>()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Correlation method: &#39;pearson&#39;
Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Don&#39;t know how to automatically pick scale for object of type noquote. Defaulting to continuous.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="cs3_practical_correlations_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
<p>The output tells us that the correlation method used is <code>pearson</code> (see below) and that only paired observations without missing values are taken into account.</p>
<p>On the right there is a scale of the strength of the correlation.</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>First, we load the data:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the data</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>USArrests_r <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/CS3-usarrests.csv&quot;</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># and have a look at the data</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(USArrests_r)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       state murder assault urban_pop robbery
1    Alabama   13.2     236        58    21.2
2     Alaska   10.0     263        48    44.5
3    Arizona    8.1     294        80    31.0
4   Arkansas    8.8     190        50    19.5
5 California    9.0     276        91    40.6
6   Colorado    7.9     204        78    38.7</code></pre>
</div>
</div>
<p>We can only calculate correlations between numerical variables, so we have to deselect the <code>state</code> variable.</p>
<p>We can load the data with an extra argument, <code>row.names = 1</code>. This will instruct R to load the data but use first column (<code>state</code>) as row names:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>USArrests_r <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/CS3-usarrests.csv&quot;</span>, <span class="at">row.names =</span> <span class="dv">1</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># have a look at the data</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(USArrests_r)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           murder assault urban_pop robbery
Alabama      13.2     236        58    21.2
Alaska       10.0     263        48    44.5
Arizona       8.1     294        80    31.0
Arkansas      8.8     190        50    19.5
California    9.0     276        91    40.6
Colorado      7.9     204        78    38.7</code></pre>
</div>
</div>
<p>We can visualise the data with the <code>pairs()</code> function. This function creates a matrix of scatter plots that we can use to look for correlations. Every combination of variables appears twice (e.g. <code>murder</code> vs <code>assault</code> is the same as <code>assault</code> vs <code>murder</code>), so we use the <code>lower.panel = NULL</code> argument to only visualise the unique combinations.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create matrix of scatter plots</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(USArrests_r, <span class="at">lower.panel =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="cs3_practical_correlations_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">

</div>
</div>
</div>
<p>From the visual inspection we can see that there appears to be a slight positive correlation between all pairs of variables, although this may be very weak in some cases (<code>murder</code> and <code>urban_pop</code> for example).</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-caption-container flex-fill">
Correlation coefficients
</div>
</div>
<div class="callout-body-container callout-body">
<p>The method we used above is <strong>Pearson’s r</strong>. This is a measure of the linear correlation between two variables. It has a value between -1 and +1, where +1 means a perfect positive correlation, -1 means a perfect negative correlation and 0 means no correlation at all.</p>
<p>There are other correlation coefficients, most notably the <strong>Spearman’s rank correlation coefficient</strong>, a non-parametric measure of rank correlation and is generally less sensitive to outliers.</p>
</div>
</div>
</section>
<section id="implement-and-interpret-test" class="level2">
<h2>Implement and interpret test</h2>
<p>A bit earlier we created a graph that visualised the possible correlations between the different variables. Underlying that were the values of Pearson’s r. If we want to get the actual values, we can do the following:</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">tidyverse</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate correlation matrix</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>USArrests <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>state) <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">correlate</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">shave</span>()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Correlation method: &#39;pearson&#39;
Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  term       murder assault urban_pop robbery
  &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 murder    NA       NA        NA          NA
2 assault    0.802   NA        NA          NA
3 urban_pop  0.0696   0.259    NA          NA
4 robbery    0.564    0.665     0.411      NA</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(USArrests_r, <span class="at">method =</span> <span class="st">&quot;pearson&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              murder   assault  urban_pop   robbery
murder    1.00000000 0.8018733 0.06957262 0.5635788
assault   0.80187331 1.0000000 0.25887170 0.6652412
urban_pop 0.06957262 0.2588717 1.00000000 0.4113412
robbery   0.56357883 0.6652412 0.41134124 1.0000000</code></pre>
</div>
</div>
<ul>
<li>The first argument is a matrix or a data frame</li>
<li>The argument <code>method</code> tells R which correlation coefficient to use (<code>pearson</code> (default), <code>kendall</code>, or <code>spearman</code>)</li>
</ul>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">

</div>
</div>
</div>
<p>The table gives the correlation coefficient between each pair of variables in the data frame. The most correlated variables are murder and assault with an <span class="math inline">\(r\)</span> value of 0.80. This appears to agree well with the set plots that we produced earlier.</p>
</section>
<section id="exercise-pearsons-r-for-usa-state-data" class="level2">
<h2>Exercise: Pearson’s r for USA state data</h2>
<p>Pearson’s correlation for USA state data</p>
<p>We will use the data from the file <code>data/CS3-statedata.csv</code> data set for this exercise. This rather more benign data set contains information on more general properties of each US state, such as population (1975), per capita income (1974), illiteracy proportion (1970), life expectancy (1969), murder rate per 100,000 people (there’s no getting away from it), percentage of the population who are high-school graduates, average number of days where the minimum temperature is below freezing between 1931 and 1960, and the state area in square miles. The data set contains 50 rows and 8 columns, with column names: <code>population</code>, <code>income</code>, <code>illiteracy</code>, <code>life_exp</code>, <code>murder</code>, <code>hs_grad</code>, <code>frost</code> and <code>area</code>.</p>
<p>Visually identify 3 different pairs of variables that appear to be</p>
<ol type="1">
<li>the most positively correlated</li>
<li>the most negatively correlated</li>
<li>not correlated at all</li>
</ol>
<p>Calculate Pearson’s r for all variable pairs and see how well you were able to identify correlation visually.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-caption-container flex-fill">
Hint
</div>
<div class='callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end'><i class='callout-toggle'></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">tidyverse</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>Look at the help page of the <code>stretch()</code> function from the <code>corrr</code> package to help extract the correct values from the correlation matrix.</p>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>Look at the help page of the <code>as.table()</code> function to help extract the correct values from the correlation matrix. Combine this with the <code>as.data.frame()</code> function.</p>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">

</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-caption-container flex-fill">
Answer
</div>
<div class='callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end'><i class='callout-toggle'></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Visually determining the most negative/positively and uncorrelated pairs of variables:</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">tidyverse</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>USAstate <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/CS3-statedata.csv&quot;</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># have a look at the data</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>USAstate</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 9
   state       population income illiteracy life_exp murder hs_grad frost   area
   &lt;chr&gt;            &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1 Alabama           3615   3624        2.1     69.0   15.1    41.3    20  50708
 2 Alaska             365   6315        1.5     69.3   11.3    66.7   152 566432
 3 Arizona           2212   4530        1.8     70.6    7.8    58.1    15 113417
 4 Arkansas          2110   3378        1.9     70.7   10.1    39.9    65  51945
 5 California       21198   5114        1.1     71.7   10.3    62.6    20 156361
 6 Colorado          2541   4884        0.7     72.1    6.8    63.9   166 103766
 7 Connecticut       3100   5348        1.1     72.5    3.1    56     139   4862
 8 Delaware           579   4809        0.9     70.1    6.2    54.6   103   1982
 9 Florida           8277   4815        1.3     70.7   10.7    52.6    11  54090
10 Georgia           4931   4091        2       68.5   13.9    40.6    60  58073
# … with 40 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualise the correlations</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>USAstate <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>state) <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">correlate</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">shave</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rplot</span>()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Correlation method: &#39;pearson&#39;
Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Don&#39;t know how to automatically pick scale for object of type noquote. Defaulting to continuous.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="cs3_practical_correlations_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>USAstate_r <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/CS3-statedata.csv&quot;</span>,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">row.names =</span> <span class="dv">1</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># have a look at the data</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(USAstate_r)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           population income illiteracy life_exp murder hs_grad frost   area
Alabama          3615   3624        2.1    69.05   15.1    41.3    20  50708
Alaska            365   6315        1.5    69.31   11.3    66.7   152 566432
Arizona          2212   4530        1.8    70.55    7.8    58.1    15 113417
Arkansas         2110   3378        1.9    70.66   10.1    39.9    65  51945
California      21198   5114        1.1    71.71   10.3    62.6    20 156361
Colorado         2541   4884        0.7    72.06    6.8    63.9   166 103766</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(USAstate_r, <span class="at">lower.panel =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="cs3_practical_correlations_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">

</div>
</div>
</div>
<p>It looks like:</p>
<ol type="1">
<li><code>illiteracy</code> and <code>murder</code> are the most positively correlated pair</li>
<li><code>life_exp</code> and <code>murder</code> are the most negatively correlated pair</li>
<li><code>population</code> and <code>area</code> are the least correlated pair</li>
</ol>
<p>We can explore that numerically, by doing the following:</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">tidyverse</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<p>We can use the <code>corrr::stretch()</code> function. This converts the correlation matrix into a long format. If we use the <code>remove.dups = TRUE</code> argument (it is <code>FALSE</code> by default) then the duplicate correlations are removed.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the correlation matrix</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># convert into long format, omitting</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># missing values and duplicates</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>USAstate_cor <span class="ot">&lt;-</span> USAstate <span class="sc">%&gt;%</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>state) <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">correlate</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stretch</span>(<span class="at">remove.dups =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>()</span></code></pre></div>
</div>
<p>Now we can extract the values we’re interested in:</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># most positively correlated pair</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>USAstate_cor <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(r <span class="sc">==</span> <span class="fu">max</span>(r))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  x          y          r
  &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;
1 illiteracy murder 0.703</code></pre>
</div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># most negatively correlated pair</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>USAstate_cor <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(r <span class="sc">==</span> <span class="fu">min</span>(r))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  x        y           r
  &lt;chr&gt;    &lt;chr&gt;   &lt;dbl&gt;
1 life_exp murder -0.781</code></pre>
</div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># least correlated pair</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>USAstate_cor <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(r <span class="sc">==</span> <span class="fu">min</span>(<span class="fu">abs</span>(r)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  x          y          r
  &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;
1 population area  0.0225</code></pre>
</div>
</div>
<p>Note that we use the minimum <em>absolute</em> value (with the <code>abs()</code> function) to find the least correlated pair.</p>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<p>First, we need to create the pairwise comparisons, with the relevant Pearson’s <span class="math inline">\(r\)</span> values:</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>USAstate_r_cor <span class="ot">&lt;-</span> USAstate_r <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create the correlation matrix</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cor</span>(<span class="at">method =</span> <span class="st">&quot;pearson&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># build a contingency table</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.table</span>() <span class="sc">|&gt;</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and create a dataframe</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># and have a look</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>USAstate_r_cor</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Var1       Var2        Freq
1  population population  1.00000000
2      income population  0.20822756
3  illiteracy population  0.10762237
4    life_exp population -0.06805195
5      murder population  0.34364275
6     hs_grad population -0.09848975
7       frost population -0.33215245
8        area population  0.02254384
9  population     income  0.20822756
10     income     income  1.00000000
11 illiteracy     income -0.43707519
12   life_exp     income  0.34025534
13     murder     income -0.23007761
14    hs_grad     income  0.61993232
15      frost     income  0.22628218
16       area     income  0.36331544
17 population illiteracy  0.10762237
18     income illiteracy -0.43707519
19 illiteracy illiteracy  1.00000000
20   life_exp illiteracy -0.58847793
21     murder illiteracy  0.70297520
22    hs_grad illiteracy -0.65718861
23      frost illiteracy -0.67194697
24       area illiteracy  0.07726113
25 population   life_exp -0.06805195
26     income   life_exp  0.34025534
27 illiteracy   life_exp -0.58847793
28   life_exp   life_exp  1.00000000
29     murder   life_exp -0.78084575
30    hs_grad   life_exp  0.58221620
31      frost   life_exp  0.26206801
32       area   life_exp -0.10733194
33 population     murder  0.34364275
34     income     murder -0.23007761
35 illiteracy     murder  0.70297520
36   life_exp     murder -0.78084575
37     murder     murder  1.00000000
38    hs_grad     murder -0.48797102
39      frost     murder -0.53888344
40       area     murder  0.22839021
41 population    hs_grad -0.09848975
42     income    hs_grad  0.61993232
43 illiteracy    hs_grad -0.65718861
44   life_exp    hs_grad  0.58221620
45     murder    hs_grad -0.48797102
46    hs_grad    hs_grad  1.00000000
47      frost    hs_grad  0.36677970
48       area    hs_grad  0.33354187
49 population      frost -0.33215245
50     income      frost  0.22628218
51 illiteracy      frost -0.67194697
52   life_exp      frost  0.26206801
53     murder      frost -0.53888344
54    hs_grad      frost  0.36677970
55      frost      frost  1.00000000
56       area      frost  0.05922910
57 population       area  0.02254384
58     income       area  0.36331544
59 illiteracy       area  0.07726113
60   life_exp       area -0.10733194
61     murder       area  0.22839021
62    hs_grad       area  0.33354187
63      frost       area  0.05922910
64       area       area  1.00000000</code></pre>
</div>
</div>
<p>Is this method obvious? No! Some create Googling led to <a href="https://stackoverflow.com/questions/7074246/show-correlations-as-an-ordered-list-not-as-a-large-matrix">Stackoverflow</a> and here we are. But, it does give us what we need.</p>
<p>Now that we have the paired comparisons, we can extract the relevant data:</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first we remove the same-pair correlations</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>USAstate_r_cor <span class="ot">&lt;-</span> USAstate_r_cor <span class="sc">|&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove the same-pair correlations</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(Freq <span class="sc">!=</span> <span class="dv">1</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>USAstate_r_cor[, <span class="fu">max</span>(USAstate_r_cor<span class="sc">$</span>Freq)]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>data frame with 0 columns and 56 rows</code></pre>
</div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># most positively correlated pair</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>USAstate_r_cor[<span class="fu">which.max</span>(USAstate_r_cor<span class="sc">$</span>Freq), ]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Var1       Var2      Freq
21 murder illiteracy 0.7029752</code></pre>
</div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># most negatively correlated pair</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>USAstate_r_cor[<span class="fu">which.min</span>(USAstate_r_cor<span class="sc">$</span>Freq), ]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Var1     Var2       Freq
29 murder life_exp -0.7808458</code></pre>
</div>
<div class="sourceCode" id="cb43"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># least correlated pair</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>USAstate_r_cor[<span class="fu">which.min</span>(<span class="fu">abs</span>(USAstate_r_cor<span class="sc">$</span>Freq)), ]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Var1       Var2       Freq
8 area population 0.02254384</code></pre>
</div>
</div>
<p>Note that we use the minimum <em>absolute</em> value (with the <code>abs()</code> function) to find the least correlated pair.</p>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">

</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="spearmans-rank-correlation-coefficient" class="level2">
<h2>Spearman’s rank correlation coefficient</h2>
<p>This test first calculates the rank of the numerical data (i.e. their position from smallest (or most negative) to the largest (or most positive)) in the two variables and then calculates Pearson’s product moment correlation coefficient using the ranks. As a consequence, this test is less sensitive to outliers in the distribution.</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">tidyverse</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate correlation matrix</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>USArrests <span class="sc">%&gt;%</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>state) <span class="sc">%&gt;%</span> </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">correlate</span>(<span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">shave</span>()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Correlation method: &#39;spearman&#39;
Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  term      murder assault urban_pop robbery
  &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 murder    NA      NA        NA          NA
2 assault    0.817  NA        NA          NA
3 urban_pop  0.107   0.275    NA          NA
4 robbery    0.679   0.714     0.438      NA</code></pre>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(USArrests_r, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             murder   assault urban_pop   robbery
murder    1.0000000 0.8172735 0.1067163 0.6794265
assault   0.8172735 1.0000000 0.2752133 0.7143681
urban_pop 0.1067163 0.2752133 1.0000000 0.4381068
robbery   0.6794265 0.7143681 0.4381068 1.0000000</code></pre>
</div>
</div>
</div>
<div id="tabset-7-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">

</div>
</div>
</div>
</section>
<section id="exercise-state-data-spearman" class="level2">
<h2>Exercise: State data (Spearman)</h2>
<p>Spearman’s correlation for USA state data</p>
<p>Calculate Spearman’s correlation coefficient for the <code>data/CS3-statedata.csv</code> data set.</p>
<p>Which variable’s correlations are affected most by the use of the Spearman’s rank compared with Pearson’s r? Hint: think of a way to address this question programmatically.</p>
<p>Thinking about the variables, can you explain why this might this be?</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-caption-container flex-fill">
Answer
</div>
<div class='callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end'><i class='callout-toggle'></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">tidyverse</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-3" role="tab" aria-controls="tabset-8-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate correlation matrix</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>USAstate <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>state) <span class="sc">%&gt;%</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">correlate</span>(<span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">shave</span>()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Correlation method: &#39;spearman&#39;
Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 9
  term       population  income illiteracy life_exp murder hs_grad  frost  area
  &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 population     NA     NA          NA       NA     NA      NA     NA        NA
2 income          0.125 NA          NA       NA     NA      NA     NA        NA
3 illiteracy      0.313 -0.315      NA       NA     NA      NA     NA        NA
4 life_exp       -0.104  0.324      -0.555   NA     NA      NA     NA        NA
5 murder          0.346 -0.217       0.672   -0.780 NA      NA     NA        NA
6 hs_grad        -0.383  0.510      -0.655    0.524 -0.437  NA     NA        NA
7 frost          -0.459  0.197      -0.683    0.298 -0.544   0.399 NA        NA
8 area           -0.121  0.0571     -0.250    0.128  0.106   0.439  0.112    NA</code></pre>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(USAstate_r, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           population      income illiteracy   life_exp     murder    hs_grad
population  1.0000000  0.12460984  0.3130496 -0.1040171  0.3457401 -0.3833649
income      0.1246098  1.00000000 -0.3145948  0.3241050 -0.2174623  0.5104809
illiteracy  0.3130496 -0.31459482  1.0000000 -0.5553735  0.6723592 -0.6545396
life_exp   -0.1040171  0.32410498 -0.5553735  1.0000000 -0.7802406  0.5239410
murder      0.3457401 -0.21746230  0.6723592 -0.7802406  1.0000000 -0.4367330
hs_grad    -0.3833649  0.51048095 -0.6545396  0.5239410 -0.4367330  1.0000000
frost      -0.4588526  0.19686382 -0.6831936  0.2983910 -0.5438432  0.3985351
area       -0.1206723  0.05709484 -0.2503721  0.1275002  0.1064259  0.4389752
                frost        area
population -0.4588526 -0.12067227
income      0.1968638  0.05709484
illiteracy -0.6831936 -0.25037208
life_exp    0.2983910  0.12750018
murder     -0.5438432  0.10642590
hs_grad     0.3985351  0.43897520
frost       1.0000000  0.11228778
area        0.1122878  1.00000000</code></pre>
</div>
</div>
</div>
<div id="tabset-8-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-3-tab">

</div>
</div>
</div>
<p>In order to determine which variables are most affected by the choice of Spearman vs Pearson you could just plot both matrices out side by side and try to spot what was going on, but one of the reasons we’re using programming languages is that we can be a bit more <strong>programmatic</strong> about these things. Also, our eyes aren’t that good at processing and parsing this sort of information display. A better way would be to somehow visualise the data.</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">tidyverse</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-3" role="tab" aria-controls="tabset-9-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<p>We’re going to subtract two correlation matrices from one another. This only works on numerical data, so we do the following:</p>
<ol type="1">
<li>calculate the correlations</li>
<li>remove the variable names</li>
<li>subtract the two matrices</li>
<li>find the absolute differences (we do not care about the direction of change)</li>
<li>put back the variable names</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create Pearson&#39;s r correlation matrix</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>USAstate_pearson <span class="ot">&lt;-</span> USAstate <span class="sc">%&gt;%</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>state) <span class="sc">%&gt;%</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">correlate</span>(<span class="at">method =</span> <span class="st">&quot;pearson&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">shave</span>() <span class="sc">%&gt;%</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>term)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Correlation method: &#39;pearson&#39;
Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
</div>
<div class="sourceCode" id="cb57"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create Spearmans correlation matrix</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>USAstate_spearman <span class="ot">&lt;-</span> USAstate <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>state) <span class="sc">%&gt;%</span> </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">correlate</span>(<span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">shave</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>term)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Correlation method: &#39;spearman&#39;
Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
</div>
<div class="sourceCode" id="cb59"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>USAstate_diff <span class="ot">&lt;-</span> USAstate_pearson <span class="sc">-</span> USAstate_spearman</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># get the row names of the correlation matrix</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>USAstate_colnames <span class="ot">&lt;-</span> USAstate <span class="sc">%&gt;%</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>state) <span class="sc">%&gt;%</span> </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">correlate</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(term)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Correlation method: &#39;pearson&#39;
Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
</div>
<div class="sourceCode" id="cb61"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine the two tables</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co"># taking the absolute values of the differences</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co"># and plot</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(USAstate_colnames, <span class="fu">abs</span>(USAstate_diff)) <span class="sc">%&gt;%</span> </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rplot</span>()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Don&#39;t know how to automatically pick scale for object of type noquote. Defaulting to continuous.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="cs3_practical_correlations_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell">
<div class="sourceCode" id="cb63"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>corPear <span class="ot">&lt;-</span> <span class="fu">cor</span>(USAstate_r, <span class="at">method =</span> <span class="st">&quot;pearson&quot;</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>corSpea <span class="ot">&lt;-</span> <span class="fu">cor</span>(USAstate_r, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>corDiff <span class="ot">&lt;-</span> corPear <span class="sc">-</span> corSpea</span></code></pre></div>
</div>
<p>Again, we could now just look at a grid of 64 numbers and see if we can spot the biggest differences, but our eyes aren’t that good at processing and parsing this sort of information display. A better way would be to somehow visualise the data. We can do that using some R plotting functions, <code>heatmap()</code> to be exact. The <code>heatmap()</code> function has a lot of features that we don’t need and so I’m not going to go into it in detail here. The main reason I’m using it is that it displays matrices the right way round (other plotting functions display matrices rotated by 90 degrees) and automatically labels the rows and columns.</p>
<div class="cell">
<div class="sourceCode" id="cb64"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap</span>(<span class="fu">abs</span>(corDiff), <span class="at">symm =</span> <span class="cn">TRUE</span>, <span class="at">Rowv =</span> <span class="cn">NA</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="cs3_practical_correlations_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
<p>The <code>abs()</code> function calculates the absolute value (i.e. just the magnitude) of the matrix values. This is just because I only care about situations where the two correlation coefficients are different from each other but I don’t care which is the larger. The <code>symm</code> argument tells the function that we have a symmetric matrix and in conjunction with the <code>Rowv = NA</code> argument stops the plot from reordering the rows and columns. The <code>Rowv = NA</code> argument also stops the function from adding dendrograms to the margins of the plot.</p>
<p>The plot itself is coloured from yellow, indicating the smallest values (which in this case correspond to no difference in correlation coefficients), through orange to dark red, indicating the biggest values (which in this case correspond to the variables with the biggest difference in correlation coefficients).</p>
<p>The plot is symmetric along the leading diagonal (hopefully for obvious reasons) and we can see that the majority of squares are light yellow in colour, which means that there isn’t much difference between Spearman and Pearson for the vast majority of variables. The squares appear darkest when we look along the <code>area</code> row/column suggesting that there’s a big difference in the correlation coefficients there.</p>
</div>
<div id="tabset-9-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-3-tab">

</div>
</div>
</div>
<p>All in all there is not a huge difference in correlation coefficients, since the values are all quite small. Most of the changes occur along the <code>area</code> variable. One possible explanation could be that certain states with a large area have a relatively large effect on the Pearson’s r coefficient. For example, Alaska has an area that is over twice as big as the next state - Texas.</p>
<p>If we’d look a bit closer then we would find for <code>area</code> and <code>income</code> that Pearson gives a value of 0.36, a slight positive correlation, whereas Spearman gives a value of 0.057, basically uncorrelated.</p>
<p>This means that this is basically ignored by Spearman.</p>
<p>Well done, <a href="https://en.wikipedia.org/wiki/Charles_Spearman">Mr. Spearman</a>.</p>
</div>
</div>
</div>
</section>
<section id="key-points" class="level2">
<h2>Key points</h2>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Correlation is the degree to which two variables are linearly related</li>
<li>Correlation does not imply causation</li>
<li>We can visualise correlations by plotting variables against each other or creating heatmap-type plots of the correlation coefficients</li>
<li>Two main correlation coefficients are Pearson’s r and Spearman’s rank, with Spearman’s rank being less sensitive to outliers</li>
</ul>
</div>
</div>
<div id="quarto-navigation-envelope" class="hidden">
<p><span class="hidden" data-render-id="quarto-int-sidebar-title">Correlations</span> <span class="hidden" data-render-id="quarto-int-navbar-title">Correlations</span> <span class="hidden" data-render-id="quarto-int-navbar:Home">Home</span> <span class="hidden" data-render-id="quarto-int-navbar:Setup">Setup</span> <span class="hidden" data-render-id="quarto-int-navbar:Materials">Materials</span> <span class="hidden" data-render-id="footer-center">Licensed <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> <img src="https://creativecommons.org/images/deed/cc_icon_black_x2.png" class="img-fluid" width="25" /> Bioinformatics Training Facility</span></p>
</div>
<div id="quarto-meta-markdown" class="hidden">
<p><span class="hidden" data-render-id="quarto-metatitle">Correlations</span> <span class="hidden" data-render-id="quarto-twittercardtitle">Correlations</span> <span class="hidden" data-render-id="quarto-ogcardtitle">Correlations</span></p>
</div>
</section>

</main> <!-- /main -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">
        <div class='footer-contents'>Licensed [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/)
![](https://creativecommons.org/images/deed/cc_icon_black_x2.png){width=25px}
Bioinformatics Training Facility
</div>  
      </div>
  </div>
</footer>

</body>

</html>